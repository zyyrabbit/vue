<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for utils\parseCode.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">utils/</a> parseCode.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">14.63% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>12/82</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/36</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/8</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">14.63% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>12/82</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">'use strict';
&nbsp;
Object.defineProperty(exports, "__esModule", {
    value: true
});
// 根据输入重复次数，输出相应字符串
var repeatN = <span class="fstat-no" title="function not covered" >function repeatN(str) {</span>
<span class="cstat-no" title="statement not covered" >    v</span>ar n = arguments.length &gt; 1 &amp;&amp; arguments[1] !== undefined ? arguments[1] : 0;
&nbsp;
<span class="cstat-no" title="statement not covered" >    v</span>ar res = '';
<span class="cstat-no" title="statement not covered" >    while (n) {</span>
<span class="cstat-no" title="statement not covered" >        if (n % 2 === 1) {</span>
<span class="cstat-no" title="statement not covered" >            r</span>es += str;
        }
<span class="cstat-no" title="statement not covered" >        if (n &gt; 1) {</span>
<span class="cstat-no" title="statement not covered" >            s</span>tr += str;
        }
<span class="cstat-no" title="statement not covered" >        n</span> &gt;&gt;= 1;
    }
<span class="cstat-no" title="statement not covered" >    r</span>eturn res;
};
var genWrapTag = <span class="fstat-no" title="function not covered" >function genWrapTag(str, tag, endFlage, text, n) {</span>
<span class="cstat-no" title="statement not covered" >    v</span>ar blankNum = repeatN('&amp;nbsp&amp;nbsp&amp;nbsp', n);
    // 需要判断是否为
<span class="cstat-no" title="statement not covered" >    r</span>eturn text ? '&lt;' + tag + ' class="hljs-tag"&gt;' + blankNum + str + '&lt;/' + tag + '&gt;' : '&lt;' + tag + ' class="hljs-tag"&gt;' + blankNum + '&amp;lt' + endFlage + str + '&amp;gt&lt;/' + tag + '&gt;';
};
&nbsp;
// 正则表达式,用于匹配格式化&lt;template&gt;代码
// 字符串空格
var regTagContent = /&lt;[^&gt;]+&gt;|(\S[^&lt;&gt;]+)/g; // 非贪婪模式
var regGetTag = /(\w[\w-]+)\s*/;
&nbsp;
var formatHtmlCode = <span class="fstat-no" title="function not covered" >function formatHtmlCode(str) {</span>
    // 用于字符串匹配栈
<span class="cstat-no" title="statement not covered" >    v</span>ar matchTags = [];
<span class="cstat-no" title="statement not covered" >    m</span>atchTags.push('-1');
    // str = blankSpace(str);
<span class="cstat-no" title="statement not covered" >    v</span>ar parseRes = '';
<span class="cstat-no" title="statement not covered" >    v</span>ar startTag = void 0;
<span class="cstat-no" title="statement not covered" >    v</span>ar tag = void 0;
<span class="cstat-no" title="statement not covered" >    v</span>ar endTagflag = void 0;
<span class="cstat-no" title="statement not covered" >    s</span>tr.replace(regTagContent, <span class="fstat-no" title="function not covered" >function (s, m) {</span>
<span class="cstat-no" title="statement not covered" >        s</span> = s &amp;&amp; s.trim();
<span class="cstat-no" title="statement not covered" >        m</span> = m &amp;&amp; m.trim();
&nbsp;
        // 如果v存在，说明为标签之间的文本匹配
<span class="cstat-no" title="statement not covered" >        if (m) {</span>
<span class="cstat-no" title="statement not covered" >            p</span>arseRes += genWrapTag(m, 'div', '', true, Math.max(matchTags.length - 1, 0));
        } else <span class="cstat-no" title="statement not covered" >if (s) {</span>
            // 去掉&lt;&gt;
<span class="cstat-no" title="statement not covered" >            s</span> = s.slice(1, -1);
            // 判断是否为tag闭合，即判断是否含有/
<span class="cstat-no" title="statement not covered" >            e</span>ndTagflag = /\//.test(s);
<span class="cstat-no" title="statement not covered" >            s</span>tartTag = matchTags.pop();
<span class="cstat-no" title="statement not covered" >            t</span>ag = s.match(regGetTag)[1];
<span class="cstat-no" title="statement not covered" >            if (endTagflag &amp;&amp; startTag === tag) {</span>
<span class="cstat-no" title="statement not covered" >                p</span>arseRes += genWrapTag(tag, 'div', '/', false, Math.max(matchTags.length - 1, 0));
            } else {
<span class="cstat-no" title="statement not covered" >                m</span>atchTags.push(startTag);
<span class="cstat-no" title="statement not covered" >                m</span>atchTags.push(tag);
<span class="cstat-no" title="statement not covered" >                p</span>arseRes += genWrapTag(s, 'div', '', false, Math.max(matchTags.length - 2, 0));
            }
        }
    });
<span class="cstat-no" title="statement not covered" >    if (matchTags.length &gt; 1) {</span>
<span class="cstat-no" title="statement not covered" >        c</span>onsole.error('输入模板不匹配！', matchTags);
<span class="cstat-no" title="statement not covered" >        r</span>eturn '';
    }
<span class="cstat-no" title="statement not covered" >    r</span>eturn parseRes;
};
// 正则表达式,用于匹配格式化&lt;script&gt;&lt;style&gt;代码
var regContent = /.+/g;
var genWrapSptAndStyTag = <span class="fstat-no" title="function not covered" >function genWrapSptAndStyTag(str, tag, n) {</span>
<span class="cstat-no" title="statement not covered" >    v</span>ar blankNum = repeatN('&amp;nbsp&amp;nbsp&amp;nbsp', n);
    // 需要判断是否为
<span class="cstat-no" title="statement not covered" >    r</span>eturn '&lt;' + tag + ' class="hljs-tag"&gt;' + blankNum + str + '&lt;/' + tag + '&gt;';
};
var formatSptAndStyCode = <span class="fstat-no" title="function not covered" >function formatSptAndStyCode(str) {</span>
    // 用于字符串匹配栈
<span class="cstat-no" title="statement not covered" >    v</span>ar matchTags = [];
<span class="cstat-no" title="statement not covered" >    m</span>atchTags.push('-1');
<span class="cstat-no" title="statement not covered" >    v</span>ar parseRes = '';
<span class="cstat-no" title="statement not covered" >    v</span>ar startTag = void 0;
<span class="cstat-no" title="statement not covered" >    v</span>ar tag = void 0;
<span class="cstat-no" title="statement not covered" >    v</span>ar nextTag = void 0;
<span class="cstat-no" title="statement not covered" >    v</span>ar preLen = void 0;
<span class="cstat-no" title="statement not covered" >    v</span>ar len = void 0;
<span class="cstat-no" title="statement not covered" >    v</span>ar blankNum = void 0;
<span class="cstat-no" title="statement not covered" >    p</span>arseRes += genWrapSptAndStyTag('&amp;ltscript&amp;gt', 'div', 0);
&nbsp;
<span class="cstat-no" title="statement not covered" >    s</span>tr.replace(regContent, <span class="fstat-no" title="function not covered" >function (s) {</span>
        // 过滤掉空格
<span class="cstat-no" title="statement not covered" >        s</span> = s.trim();
        // 全局匹配
<span class="cstat-no" title="statement not covered" >        t</span>ag = s.match(/[{}]/g);
<span class="cstat-no" title="statement not covered" >        b</span>lankNum = matchTags.length;
<span class="cstat-no" title="statement not covered" >        if (tag) {</span>
<span class="cstat-no" title="statement not covered" >            p</span>reLen = len = tag.length;
<span class="cstat-no" title="statement not covered" >            while (len &gt; 0) {</span>
<span class="cstat-no" title="statement not covered" >                n</span>extTag = tag.shift();
<span class="cstat-no" title="statement not covered" >                s</span>tartTag = matchTags.pop();
<span class="cstat-no" title="statement not covered" >                if (startTag !== '{' || nextTag !== '}') {</span>
<span class="cstat-no" title="statement not covered" >                    m</span>atchTags.push(startTag);
<span class="cstat-no" title="statement not covered" >                    m</span>atchTags.push(nextTag);
                }
<span class="cstat-no" title="statement not covered" >                l</span>en--;
            }
        }
        // 暂时解决{}空格不匹配的问题
<span class="cstat-no" title="statement not covered" >        if (preLen === 1 &amp;&amp; nextTag === '}') {</span>
<span class="cstat-no" title="statement not covered" >            b</span>lankNum -= 1;
        }
<span class="cstat-no" title="statement not covered" >        p</span>arseRes += genWrapSptAndStyTag(s, 'div', blankNum);
    });
<span class="cstat-no" title="statement not covered" >    if (matchTags.length &gt; 1) {</span>
<span class="cstat-no" title="statement not covered" >        c</span>onsole.error('输入模板不匹配！', matchTags);
<span class="cstat-no" title="statement not covered" >        r</span>eturn '';
    }
<span class="cstat-no" title="statement not covered" >    p</span>arseRes += genWrapSptAndStyTag('&amp;lt/script&amp;gt', 'div', 0);
<span class="cstat-no" title="statement not covered" >    r</span>eturn parseRes;
};
// 包装输出
var matchMethods = {
    formatHtmlCode: formatHtmlCode,
    formatSptAndStyCode: formatSptAndStyCode
};
var formatCode = <span class="fstat-no" title="function not covered" >function formatCode(matchType, str) {</span>
<span class="cstat-no" title="statement not covered" >    r</span>eturn matchMethods[matchType](str);
};
exports.default = formatCode;
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Sep 26 2018 19:01:33 GMT+0800 (中国标准时间)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
